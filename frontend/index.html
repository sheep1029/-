<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InnoCore Research</title>
    <style>
        :root {
            --bg-0: #070a17;
            --bg-1: #0b1028;
            --surface: rgba(255, 255, 255, 0.86);
            --surface-strong: rgba(255, 255, 255, 0.94);
            --border: rgba(255, 255, 255, 0.55);
            --text: #111827;
            --muted: #475569;
            --muted-2: #64748b;
            --primary: #4f46e5;
            --primary-2: #7c3aed;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #f59e0b;
            --shadow-1: 0 8px 22px rgba(2, 6, 23, 0.18);
            --shadow-2: 0 18px 55px rgba(2, 6, 23, 0.28);
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --ring: 0 0 0 4px rgba(79, 70, 229, 0.16);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            -webkit-text-size-adjust: 100%;
            text-rendering: optimizeLegibility;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            min-height: 100vh;
            color: var(--text);
            background:
                radial-gradient(900px 520px at 12% 18%, rgba(79, 70, 229, 0.55), transparent 60%),
                radial-gradient(820px 520px at 86% 18%, rgba(124, 58, 237, 0.45), transparent 55%),
                radial-gradient(980px 620px at 50% 92%, rgba(56, 189, 248, 0.14), transparent 65%),
                linear-gradient(180deg, var(--bg-0), var(--bg-1));
        }

        a {
            color: inherit;
        }

        .icon {
            width: 1.1em;
            height: 1.1em;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
        }

        .icon svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .btn .icon {
            margin-right: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px 20px 44px;
        }

        header {
            text-align: center;
            padding: 44px 0 22px;
            color: rgba(255, 255, 255, 0.92);
        }

        header h1 {
            font-size: clamp(2.2rem, 4vw, 3.2rem);
            letter-spacing: -0.02em;
            margin-bottom: 10px;
            text-shadow: 0 18px 38px rgba(0, 0, 0, 0.35);
        }

        header p {
            font-size: 1.08rem;
            color: rgba(255, 255, 255, 0.78);
            max-width: 720px;
            margin: 0 auto;
        }

        .main-content {
            background: var(--surface);
            border: 1px solid var(--border);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: var(--radius-lg);
            padding: 34px;
            box-shadow: var(--shadow-2);
            margin: 20px 0 30px;
        }

        .main-content h2 {
            font-size: 1.35rem;
            letter-spacing: -0.01em;
            margin: 6px 0 16px;
        }

        .mode-banner {
            margin: 18px 0 10px;
            padding: 16px 16px;
            background: rgba(79, 70, 229, 0.06);
            border: 1px solid rgba(79, 70, 229, 0.18);
            border-radius: var(--radius-md);
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }

        .mode-banner-title {
            min-width: 112px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
            margin-top: 2px;
        }

        .mode-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 14px;
            align-items: center;
        }

        .mode-option {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            color: var(--muted);
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid rgba(2, 6, 23, 0.10);
            background: rgba(255, 255, 255, 0.60);
            transition: transform 0.16s ease, background 0.16s ease, border-color 0.16s ease;
        }

        .mode-option:hover {
            transform: translateY(-1px);
            background: rgba(255, 255, 255, 0.78);
            border-color: rgba(79, 70, 229, 0.28);
        }

        .mode-option input {
            accent-color: var(--primary);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 18px;
            margin-top: 18px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(2, 6, 23, 0.10);
            padding: 22px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-1);
            transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background 0.18s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(420px 220px at 0% 0%, rgba(79, 70, 229, 0.14), transparent 60%);
            opacity: 0;
            transition: opacity 0.18s ease;
            pointer-events: none;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 48px rgba(2, 6, 23, 0.18);
            border-color: rgba(79, 70, 229, 0.24);
            background: rgba(255, 255, 255, 0.86);
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-card.active {
            border-color: rgba(79, 70, 229, 0.40);
            background: rgba(79, 70, 229, 0.07);
        }

        .feature-card h3 {
            color: var(--text);
            margin-bottom: 10px;
            font-size: 1.15rem;
            letter-spacing: -0.01em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-card p {
            color: var(--muted);
            line-height: 1.65;
            margin-bottom: 14px;
        }

        .feature-card--workflow {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.92) 0%, rgba(124, 58, 237, 0.92) 55%, rgba(14, 165, 233, 0.70) 100%);
            border-color: rgba(255, 255, 255, 0.24);
            color: rgba(255, 255, 255, 0.92);
        }

        .feature-card--workflow h3,
        .feature-card--workflow p {
            color: rgba(255, 255, 255, 0.92);
        }

        .btn {
            appearance: none;
            border: 1px solid rgba(2, 6, 23, 0.12);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            color: rgba(255, 255, 255, 0.98);
            padding: 10px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: -0.01em;
            transition: transform 0.16s ease, box-shadow 0.16s ease, filter 0.16s ease;
            box-shadow: 0 10px 22px rgba(79, 70, 229, 0.22);
        }

        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.02);
            box-shadow: 0 14px 28px rgba(79, 70, 229, 0.26);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--ring), 0 14px 28px rgba(79, 70, 229, 0.26);
        }

        .btn:disabled {
            opacity: 0.55;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-invert {
            background: rgba(255, 255, 255, 0.92);
            color: rgba(79, 70, 229, 0.95);
            border-color: rgba(255, 255, 255, 0.44);
            box-shadow: 0 18px 40px rgba(2, 6, 23, 0.18);
        }

        .btn-invert:hover {
            filter: brightness(1.02);
            box-shadow: 0 22px 50px rgba(2, 6, 23, 0.22);
        }

        .btn-ghost {
            background: transparent;
            color: rgba(79, 70, 229, 0.95);
            border: 1px solid rgba(79, 70, 229, 0.25);
            box-shadow: none;
        }

        .btn-ghost:hover {
            background: rgba(79, 70, 229, 0.06);
            border-color: rgba(79, 70, 229, 0.36);
            box-shadow: none;
        }

        .btn-workflow {
            width: 100%;
            justify-content: center;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 22px 0 28px;
            flex-wrap: wrap;
        }

        .nav-buttons a.btn {
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .status {
            background: rgba(22, 163, 74, 0.10);
            border: 1px solid rgba(22, 163, 74, 0.25);
            color: #065f46;
            padding: 14px 14px;
            border-radius: var(--radius-md);
            margin: 10px 0 18px;
            font-weight: 600;
        }

        .workflow-intro {
            color: var(--muted);
            margin-bottom: 16px;
            line-height: 1.7;
        }

        .error {
            background: rgba(220, 38, 38, 0.10);
            border: 1px solid rgba(220, 38, 38, 0.20);
            color: #7f1d1d;
            padding: 14px;
            border-radius: var(--radius-md);
            margin: 10px 0;
        }

        .success {
            background: rgba(22, 163, 74, 0.10);
            border: 1px solid rgba(22, 163, 74, 0.20);
            color: #065f46;
            padding: 14px;
            border-radius: var(--radius-md);
            margin: 10px 0;
        }

        .interaction-panel {
            background: rgba(255, 255, 255, 0.72);
            border: 1px solid rgba(2, 6, 23, 0.10);
            border-radius: var(--radius-lg);
            padding: 26px;
            margin-top: 22px;
            box-shadow: var(--shadow-1);
            display: none;
        }

        .interaction-panel.active {
            display: block;
        }

        .interaction-panel > .btn {
            width: 100%;
            justify-content: center;
        }

        .interaction-panel h3 {
            font-size: 1.15rem;
            letter-spacing: -0.01em;
            margin-bottom: 12px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--text);
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px 12px;
            border: 1px solid rgba(2, 6, 23, 0.14);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.85);
            transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: rgba(79, 70, 229, 0.55);
            box-shadow: var(--ring);
            background: rgba(255, 255, 255, 0.95);
        }

        .input-group textarea {
            min-height: 130px;
            resize: vertical;
        }

        .file-upload {
            border: 1px dashed rgba(79, 70, 229, 0.55);
            border-radius: 14px;
            padding: 22px;
            text-align: center;
            cursor: pointer;
            background: rgba(79, 70, 229, 0.04);
            transition: transform 0.16s ease, background 0.16s ease, border-color 0.16s ease;
        }

        .file-upload:hover {
            transform: translateY(-1px);
            background: rgba(79, 70, 229, 0.07);
            border-color: rgba(79, 70, 229, 0.75);
        }

        .file-upload.dragover {
            background: rgba(79, 70, 229, 0.10);
            border-color: rgba(79, 70, 229, 0.85);
        }

        .toggle {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: var(--text);
            user-select: none;
            cursor: pointer;
        }

        .toggle input {
            accent-color: var(--primary);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 16px 0 6px;
            color: var(--muted);
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(2, 6, 23, 0.10);
            border-top: 3px solid rgba(79, 70, 229, 0.95);
            border-radius: 50%;
            width: 38px;
            height: 38px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .response-area {
            background: rgba(255, 255, 255, 0.70);
            border: 1px solid rgba(2, 6, 23, 0.12);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-top: 16px;
            min-height: 200px;
            max-height: 520px;
            overflow-y: auto;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
            color: var(--text);
        }

        .response-area pre {
            background: rgba(255, 255, 255, 0.88);
            border: 1px solid rgba(2, 6, 23, 0.10);
            padding: 14px;
            border-radius: 14px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.92rem;
            line-height: 1.65;
            box-shadow: 0 10px 22px rgba(2, 6, 23, 0.10);
        }

        .result-header {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.95) 0%, rgba(124, 58, 237, 0.90) 70%);
            color: rgba(255, 255, 255, 0.96);
            padding: 14px 16px;
            border-radius: 14px 14px 0 0;
            margin: -18px -18px 14px -18px;
            font-weight: 800;
            display: flex;
            justify-content: space-between;
            align-items: center;
            letter-spacing: -0.01em;
        }

        .result-stats {
            background: rgba(255, 255, 255, 0.18);
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .paper-card {
            background: rgba(255, 255, 255, 0.82);
            border: 1px solid rgba(2, 6, 23, 0.10);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin: 14px 0;
            transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
            box-shadow: var(--shadow-1);
        }

        .paper-card:hover {
            box-shadow: 0 18px 50px rgba(2, 6, 23, 0.18);
            transform: translateY(-2px);
            border-color: rgba(79, 70, 229, 0.22);
        }

        .paper-card h4 {
            color: var(--text);
            margin-bottom: 10px;
            font-size: 1.05rem;
            line-height: 1.45;
            letter-spacing: -0.01em;
        }

        .paper-card .authors {
            color: var(--muted);
            font-size: 0.92rem;
            margin: 8px 0;
        }

        .paper-card .abstract {
            color: #1f2937;
            line-height: 1.7;
            margin: 12px 0;
            font-size: 0.96rem;
        }

        .paper-card .meta {
            display: flex;
            gap: 14px;
            margin-top: 12px;
            font-size: 0.86rem;
            color: var(--muted-2);
            flex-wrap: wrap;
        }

        .paper-card .meta span {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .paper-card pre {
            background: rgba(255, 255, 255, 0.88);
            border: 1px solid rgba(2, 6, 23, 0.10);
            padding: 14px;
            border-radius: 14px;
            overflow-x: auto;
            margin: 10px 0 0;
            font-size: 0.92rem;
            line-height: 1.65;
            box-shadow: 0 10px 22px rgba(2, 6, 23, 0.08);
        }

        .muted {
            color: var(--muted);
        }

        .paper-card a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
        }

        .paper-card a:hover {
            text-decoration: underline;
        }

        .copy-btn {
            float: right;
            background: rgba(79, 70, 229, 0.08);
            border: 1px solid rgba(79, 70, 229, 0.25);
            color: rgba(79, 70, 229, 0.95);
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            font-size: 0.86rem;
            font-weight: 700;
            transition: transform 0.16s ease, background 0.16s ease, border-color 0.16s ease;
            margin-left: 10px;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            background: rgba(79, 70, 229, 0.14);
            border-color: rgba(79, 70, 229, 0.40);
        }

        .copy-btn:focus-visible {
            outline: none;
            box-shadow: var(--ring);
        }

        .empty-state {
            text-align: center;
            padding: 34px 16px;
            color: var(--muted-2);
            font-size: 1.05rem;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 800;
            margin-left: 8px;
        }

        .badge-success {
            background: rgba(22, 163, 74, 0.12);
            color: #166534;
        }

        .badge-info {
            background: rgba(14, 165, 233, 0.14);
            color: #075985;
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.16);
            color: #92400e;
        }

        .json-key {
            color: #1d4ed8;
            font-weight: 800;
        }

        .json-string {
            color: #15803d;
        }

        .json-number {
            color: #c2410c;
        }

        .json-boolean {
            color: #7c3aed;
            font-weight: 800;
        }

        .json-null {
            color: var(--muted-2);
            font-style: italic;
        }

        .markdown-content {
            line-height: 1.85;
            color: #0f172a;
        }

        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            color: #0f172a;
            margin-top: 18px;
            margin-bottom: 10px;
            letter-spacing: -0.01em;
        }

        .markdown-content h1 {
            font-size: 1.35rem;
        }

        .markdown-content h2 {
            font-size: 1.2rem;
        }

        .markdown-content h3 {
            font-size: 1.08rem;
        }

        .markdown-content ul {
            list-style-type: disc;
            padding-left: 22px;
            margin: 12px 0;
        }

        .markdown-content li {
            margin: 8px 0;
            line-height: 1.8;
        }

        .markdown-content strong {
            color: #0f172a;
            font-weight: 800;
        }

        .markdown-content code {
            background: rgba(2, 6, 23, 0.06);
            padding: 2px 6px;
            border-radius: 6px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
            color: #be185d;
            font-size: 0.92em;
        }

        .markdown-content pre {
            background: rgba(2, 6, 23, 0.04);
            padding: 14px;
            border-radius: 14px;
            overflow-x: auto;
            border: 1px solid rgba(2, 6, 23, 0.10);
            margin: 14px 0;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
            color: #0f172a;
        }

        .markdown-content a {
            color: var(--primary);
            text-decoration: none;
            border-bottom: 1px solid rgba(79, 70, 229, 0.35);
        }

        .markdown-content a:hover {
            border-bottom-color: rgba(79, 70, 229, 0.65);
        }

        .markdown-content p {
            margin: 10px 0;
            line-height: 1.85;
        }

        @media (max-width: 720px) {
            .container {
                padding: 18px 14px 30px;
            }

            .main-content {
                padding: 20px;
            }

            .mode-banner {
                flex-direction: column;
            }

            .mode-banner-title {
                min-width: auto;
            }
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --surface: rgba(15, 23, 42, 0.68);
                --surface-strong: rgba(15, 23, 42, 0.80);
                --border: rgba(148, 163, 184, 0.16);
                --text: rgba(226, 232, 240, 0.96);
                --muted: rgba(203, 213, 225, 0.78);
                --muted-2: rgba(203, 213, 225, 0.65);
                --ring: 0 0 0 4px rgba(99, 102, 241, 0.28);
            }

            .main-content,
            .interaction-panel,
            .feature-card,
            .paper-card,
            .response-area {
                background: var(--surface);
                border-color: var(--border);
            }

            .mode-banner {
                background: rgba(99, 102, 241, 0.10);
                border-color: rgba(99, 102, 241, 0.22);
            }

            .mode-option {
                background: rgba(15, 23, 42, 0.55);
                border-color: rgba(148, 163, 184, 0.18);
                color: var(--muted);
            }

            .btn-ghost {
                color: rgba(165, 180, 252, 0.95);
                border-color: rgba(165, 180, 252, 0.25);
            }

            .btn-ghost:hover {
                background: rgba(99, 102, 241, 0.10);
                border-color: rgba(165, 180, 252, 0.38);
            }

            .input-group input,
            .input-group textarea,
            .input-group select {
                background: rgba(15, 23, 42, 0.55);
                border-color: rgba(148, 163, 184, 0.18);
                color: var(--text);
            }

            .markdown-content {
                color: var(--text);
            }

            .markdown-content strong,
            .markdown-content h1,
            .markdown-content h2,
            .markdown-content h3 {
                color: var(--text);
            }

            .status,
            .success {
                color: rgba(134, 239, 172, 0.95);
            }

            .error {
                color: rgba(254, 202, 202, 0.95);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>InnoCore Research</h1>
            <p>åŸºäºå¤šæ™ºèƒ½ä½“åä½œçš„æ™ºèƒ½ç§‘ç ”åˆ›æ–°åŠ©æ‰‹å¹³å°</p>
        </header>

        <main class="main-content">
            <div class="status" id="systemStatus">
                æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...
            </div>

            <div class="nav-buttons">
                <a href="/docs" class="btn btn-ghost" target="_blank">
                    <span class="icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                            <path d="M8 6h8" />
                            <path d="M8 10h8" />
                        </svg>
                    </span>
                    <span>æ¥å£æ–‡æ¡£</span>
                </a>
                <a href="/health" class="btn btn-ghost" target="_blank">ğŸ©º å¥åº·æ£€æŸ¥</a>
                <button class="btn" onclick="checkSystemStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
            </div>

            <section>
                <h2>æ ¸å¿ƒåŠŸèƒ½</h2>

                <!-- å·¥ä½œæµæ¨¡å¼é€‰æ‹© -->
                <div class="mode-banner">
                    <div class="mode-banner-title">å·¥ä½œæ¨¡å¼</div>
                    <div class="mode-options">
                        <label class="mode-option">
                            <input type="radio" name="work-mode" value="individual" checked>
                            <span>å•ä½“æ¨¡å¼ï¼šåˆ†åˆ«ä½¿ç”¨æ¯ä¸ªæ™ºèƒ½ä½“</span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="work-mode" value="workflow">
                            <span>ååŒæ¨¡å¼ï¼šè‡ªåŠ¨åŒ–å®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰</span>
                        </label>
                    </div>
                </div>

                <div class="features">
                    <div class="feature-card feature-card--workflow" onclick="activateAgent('workflow')" id="workflow-card"
                        style="display: none;">
                        <h3>ğŸ§© ååŒå·¥ä½œæµ</h3>
                        <p>è‡ªåŠ¨åè°ƒå¤šä¸ªæ™ºèƒ½ä½“ï¼šæ£€ç´¢è®ºæ–‡ â†’ æ·±åº¦åˆ†æ â†’ ç”Ÿæˆå¼•ç”¨ â†’ è¾“å‡ºæŠ¥å‘Š</p>
                        <button class="btn btn-invert"
                            onclick="event.stopPropagation(); activateAgent('workflow')">è¿›å…¥å·¥ä½œæµ</button>
                    </div>

                    <div class="feature-card" onclick="activateAgent('hunter')" id="hunter-card">
                        <h3>
                            <span class="icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="7" />
                                    <path d="M21 21l-4.35-4.35" />
                                </svg>
                            </span>
                            <span>Hunterï¼ˆæ–‡çŒ®æ£€ç´¢ï¼‰</span>
                        </h3>
                        <p>æ™ºèƒ½æ£€ç´¢ä¸è¿½è¸ªæœ€æ–°ç ”ç©¶ï¼Œæ”¯æŒ ArXivã€IEEE ç­‰ä¸»æµæ¥æº</p>
                        <button class="btn" onclick="event.stopPropagation(); activateAgent('hunter')">å¼€å§‹æ£€ç´¢</button>
                    </div>

                    <div class="feature-card" onclick="activateAgent('miner')" id="miner-card">
                        <h3>ğŸ“Š Minerï¼ˆè®ºæ–‡åˆ†æï¼‰</h3>
                        <p>æ·±åº¦è§£æè®ºæ–‡å†…å®¹ï¼Œæç‚¼å…³é”®ç»“è®ºä¸åˆ›æ–°ç‚¹ï¼Œè¾“å‡ºç»“æ„åŒ–æŠ¥å‘Š</p>
                        <button class="btn" onclick="event.stopPropagation(); activateAgent('miner')">åˆ†æè®ºæ–‡</button>
                    </div>

                    <div class="feature-card" onclick="activateAgent('coach')" id="coach-card">
                        <h3>âœï¸ Coachï¼ˆå†™ä½œåŠ©æ‰‹ï¼‰</h3>
                        <p>å­¦æœ¯å†™ä½œè¾…åŠ©ï¼šæ¶¦è‰²ã€é£æ ¼è°ƒæ•´ã€ç¿»è¯‘ä¸å†…å®¹æ‰©å†™</p>
                        <button class="btn" onclick="event.stopPropagation(); activateAgent('coach')">å¼€å§‹å†™ä½œ</button>
                    </div>

                    <div class="feature-card" onclick="activateAgent('validator')" id="validator-card">
                        <h3>ğŸ§¾ Validatorï¼ˆå¼•ç”¨æ ¡éªŒï¼‰</h3>
                        <p>å¼•ç”¨ä¿¡æ¯è§£æä¸æ ¼å¼åŒ–ï¼Œè¾“å‡º BibTeX/APA/IEEE ç­‰æ ‡å‡†æ ¼å¼</p>
                        <button class="btn" onclick="event.stopPropagation(); activateAgent('validator')">æ ¡éªŒä¸æ ¼å¼åŒ–</button>
                    </div>
                </div>
            </section>

            <!-- Hunter Agent äº¤äº’é¢æ¿ -->
            <div class="interaction-panel" id="hunter-panel">
                <h3>
                    <span class="icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="7" />
                            <path d="M21 21l-4.35-4.35" />
                        </svg>
                    </span>
                    <span>æ–‡çŒ®æ£€ç´¢</span>
                </h3>
                <div class="input-group">
                    <label for="search-keywords">æœç´¢å…³é”®è¯</label>
                    <input type="text" id="search-keywords"
                        placeholder="ä¾‹å¦‚ï¼šmachine learning, natural language processing">
                </div>
                <div class="input-group">
                    <label for="search-source">æœç´¢æ¥æº</label>
                    <select id="search-source">
                        <option value="arxiv">ArXiv</option>
                        <option value="ieee">IEEE</option>
                        <option value="pubmed">PubMed</option>
                        <option value="all">å…¨éƒ¨æ¥æº</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="search-limit">æœ€å¤§è¿”å›æ•°é‡</label>
                    <input type="number" id="search-limit" value="10" min="1" max="50">
                </div>
                <button class="btn" onclick="executeHunterTask()">å¼€å§‹æ£€ç´¢</button>
                <div class="loading" id="hunter-loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æœç´¢è®ºæ–‡...</p>
                </div>
                <div class="response-area" id="hunter-response"></div>
            </div>

            <!-- Miner Agent äº¤äº’é¢æ¿ -->
            <div class="interaction-panel" id="miner-panel">
                <h3>ğŸ“Š è®ºæ–‡åˆ†æ</h3>
                <div class="input-group">
                    <label for="paper-upload">ä¸Šä¼ è®ºæ–‡ (PDF)</label>
                    <div class="file-upload" id="paper-upload-area">
                        <p>ğŸ“„ ç‚¹å‡»æˆ–æ‹–æ‹½ PDF æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <input type="file" id="paper-file" accept=".pdf" style="display: none;">
                    </div>
                </div>
                <div class="input-group">
                    <label for="paper-url">æˆ–è¾“å…¥è®ºæ–‡é“¾æ¥</label>
                    <input type="url" id="paper-url" placeholder="https://arxiv.org/abs/...">
                </div>
                <div class="input-group">
                    <label for="analysis-type">åˆ†æç±»å‹</label>
                    <select id="analysis-type">
                        <option value="summary">å†…å®¹æ‘˜è¦</option>
                        <option value="innovation">åˆ›æ–°ç‚¹åˆ†æ</option>
                        <option value="comparison">å¯¹æ¯”åˆ†æ</option>
                        <option value="comprehensive">ç»¼åˆåˆ†æ</option>
                    </select>
                </div>
                <button class="btn" onclick="executeMinerTask()">å¼€å§‹åˆ†æ</button>
                <div class="loading" id="miner-loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æè®ºæ–‡...</p>
                </div>
                <div class="response-area" id="miner-response"></div>
            </div>

            <!-- Coach Agent äº¤äº’é¢æ¿ -->
            <div class="interaction-panel" id="coach-panel">
                <h3>âœï¸ å†™ä½œåŠ©æ‰‹</h3>
                <div class="input-group">
                    <label for="writing-text">åŸå§‹æ–‡æœ¬</label>
                    <textarea id="writing-text" placeholder="è¯·è¾“å…¥éœ€è¦å¤„ç†çš„å­¦æœ¯æ–‡æœ¬..."></textarea>
                </div>
                <div class="input-group">
                    <label for="writing-style">å†™ä½œé£æ ¼</label>
                    <select id="writing-style">
                        <option value="formal">æ­£å¼å­¦æœ¯é£æ ¼</option>
                        <option value="nature">Natureé£æ ¼</option>
                        <option value="science">Scienceé£æ ¼</option>
                        <option value="ieee">IEEEé£æ ¼</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="writing-task">ä»»åŠ¡ç±»å‹</label>
                    <select id="writing-task">
                        <option value="polish">æ¶¦è‰²ä¼˜åŒ–</option>
                        <option value="translate">ç¿»è¯‘ï¼ˆä¸­è¯‘è‹±ï¼‰</option>
                        <option value="explain">æ¦‚å¿µè§£é‡Š</option>
                        <option value="expand">å†…å®¹æ‰©å†™</option>
                    </select>
                </div>
                <button class="btn" onclick="executeCoachTask()">å¼€å§‹å¤„ç†</button>
                <div class="loading" id="coach-loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨å¤„ç†æ–‡æœ¬...</p>
                </div>
                <div class="response-area" id="coach-response"></div>
            </div>

            <!-- Validator Agent äº¤äº’é¢æ¿ -->
            <div class="interaction-panel" id="validator-panel">
                <h3>ğŸ§¾ å¼•ç”¨æ ¡éªŒä¸æ ¼å¼åŒ–</h3>
                <div class="input-group">
                    <label for="citation-input">å¼•ç”¨ä¿¡æ¯</label>
                    <textarea id="citation-input" placeholder="è¯·è¾“å…¥å¼•ç”¨ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯DOIã€æ ‡é¢˜ã€æˆ–BibTeXæ ¼å¼..."></textarea>
                </div>
                <div class="input-group">
                    <label for="citation-format">è¾“å‡ºæ ¼å¼</label>
                    <select id="citation-format">
                        <option value="bibtex">BibTeX</option>
                        <option value="apa">APA</option>
                        <option value="ieee">IEEE</option>
                        <option value="mla">MLA</option>
                    </select>
                </div>
                <button class="btn" onclick="executeValidatorTask()">å¼€å§‹æ ¡éªŒ</button>
                <div class="loading" id="validator-loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æ ¡éªŒå¼•ç”¨...</p>
                </div>
                <div class="response-area" id="validator-response"></div>
            </div>

            <!-- Workflow åè°ƒé¢æ¿ -->
            <div class="interaction-panel" id="workflow-panel">
                <h3>ğŸ§© ååŒå·¥ä½œæµ</h3>
                <p class="workflow-intro">è‡ªåŠ¨åè°ƒå¤šä¸ªæ™ºèƒ½ä½“ï¼Œå®Œæˆâ€œæ£€ç´¢ â†’ åˆ†æ â†’ å¼•ç”¨ â†’ æŠ¥å‘Šâ€çš„å®Œæ•´ç ”ç©¶æµç¨‹ã€‚</p>

                <div class="input-group">
                    <label for="workflow-keywords">ç ”ç©¶å…³é”®è¯</label>
                    <input type="text" id="workflow-keywords" placeholder="ä¾‹å¦‚: deep learning for computer vision">
                </div>

                <div class="input-group">
                    <label for="workflow-limit">æœç´¢è®ºæ–‡æ•°é‡</label>
                    <select id="workflow-limit">
                        <option value="3">3ç¯‡ï¼ˆå¿«é€Ÿï¼‰</option>
                        <option value="5" selected>5ç¯‡ï¼ˆæ¨èï¼‰</option>
                        <option value="10">10ç¯‡ï¼ˆè¯¦ç»†ï¼‰</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="workflow-analysis-type">åˆ†æç±»å‹</label>
                    <select id="workflow-analysis-type">
                        <option value="summary">æ‘˜è¦åˆ†æ</option>
                        <option value="innovation">åˆ›æ–°ç‚¹åˆ†æ</option>
                        <option value="comparison">å¯¹æ¯”åˆ†æ</option>
                        <option value="comprehensive">ç»¼åˆåˆ†æ</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="workflow-citation-format">å¼•ç”¨æ ¼å¼</label>
                    <select id="workflow-citation-format">
                        <option value="bibtex">BibTeX</option>
                        <option value="apa">APA</option>
                        <option value="ieee">IEEE</option>
                        <option value="mla">MLA</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="toggle">
                        <input type="checkbox" id="workflow-generate-report" checked>
                        ç”Ÿæˆç»¼åˆæŠ¥å‘Š
                    </label>
                </div>

                <button class="btn btn-workflow" onclick="executeWorkflow()">å¯åŠ¨ååŒå·¥ä½œæµ</button>

                <div class="loading" id="workflow-loading">
                    <div class="spinner"></div>
                    <p>å·¥ä½œæµæ‰§è¡Œä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>

                <div class="response-area" id="workflow-response"></div>
            </div>
        </main>
    </div>

    <script>
        let currentAgent = null;

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function () {
            checkSystemStatus();
            setupFileUpload();
            setupWorkModeSwitch();
        });

        // è®¾ç½®å·¥ä½œæ¨¡å¼åˆ‡æ¢
        function setupWorkModeSwitch() {
            const modeRadios = document.querySelectorAll('input[name="work-mode"]');
            modeRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    const workflowCard = document.getElementById('workflow-card');
                    if (this.value === 'workflow') {
                        workflowCard.style.display = 'block';
                    } else {
                        workflowCard.style.display = 'none';
                    }
                });
            });
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            try {
                const response = await fetch('/health');
                const data = await response.json();

                if (response.ok) {
                    statusDiv.className = 'status';
                    statusDiv.innerHTML = `ç³»ç»ŸçŠ¶æ€ï¼šæ­£å¸¸ï¼ˆ${data.status}ï¼‰ï½œ${new Date().toLocaleString()}`;
                } else {
                    throw new Error('ç³»ç»ŸçŠ¶æ€å¼‚å¸¸');
                }
            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.innerHTML = `ç³»ç»Ÿè¿æ¥å¤±è´¥ï¼š${error.message}`;
            }
        }

        // æ¿€æ´»æ™ºèƒ½ä½“
        function activateAgent(agentType) {
            // é‡ç½®æ‰€æœ‰å¡ç‰‡å’Œé¢æ¿
            document.querySelectorAll('.feature-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll('.interaction-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // æ¿€æ´»é€‰ä¸­çš„æ™ºèƒ½ä½“
            currentAgent = agentType;
            document.getElementById(`${agentType}-card`).classList.add('active');
            document.getElementById(`${agentType}-panel`).classList.add('active');
        }

        // æ‰§è¡ŒHunterä»»åŠ¡
        async function executeHunterTask() {
            const keywords = document.getElementById('search-keywords').value;
            const source = document.getElementById('search-source').value;
            const limit = document.getElementById('search-limit').value;

            if (!keywords.trim()) {
                showError('hunter-response', 'è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            showLoading('hunter-loading');

            try {
                const response = await fetch('/api/v1/papers/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        keywords: keywords,
                        source: source,
                        limit: parseInt(limit)
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess('hunter-response', `æ‰¾åˆ° ${data.papers?.length || 0} ç¯‡ç›¸å…³è®ºæ–‡`, data);
                } else {
                    showError('hunter-response', data.detail || 'æœç´¢å¤±è´¥');
                }
            } catch (error) {
                showError('hunter-response', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('hunter-loading');
            }
        }

        // æ‰§è¡ŒMinerä»»åŠ¡
        async function executeMinerTask() {
            const paperUrl = document.getElementById('paper-url').value;
            const analysisType = document.getElementById('analysis-type').value;

            if (!paperUrl.trim()) {
                showError('miner-response', 'è¯·è¾“å…¥è®ºæ–‡URLæˆ–ä¸Šä¼ PDFæ–‡ä»¶');
                return;
            }

            showLoading('miner-loading');

            try {
                const response = await fetch('/api/v1/analysis/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        paper_url: paperUrl,
                        analysis_type: analysisType
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess('miner-response', 'è®ºæ–‡åˆ†æå®Œæˆ', data);
                } else {
                    showError('miner-response', data.detail || 'åˆ†æå¤±è´¥');
                }
            } catch (error) {
                showError('miner-response', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('miner-loading');
            }
        }

        // æ‰§è¡ŒCoachä»»åŠ¡
        async function executeCoachTask() {
            const text = document.getElementById('writing-text').value;
            const style = document.getElementById('writing-style').value;
            const task = document.getElementById('writing-task').value;

            if (!text.trim()) {
                showError('coach-response', 'è¯·è¾“å…¥éœ€è¦å¤„ç†çš„æ–‡æœ¬');
                return;
            }

            showLoading('coach-loading');

            try {
                const response = await fetch('/api/v1/writing/coach', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        style: style,
                        task: task
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess('coach-response', 'æ–‡æœ¬å¤„ç†å®Œæˆ', data);
                } else {
                    showError('coach-response', data.detail || 'å¤„ç†å¤±è´¥');
                }
            } catch (error) {
                showError('coach-response', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('coach-loading');
            }
        }

        // æ‰§è¡ŒValidatorä»»åŠ¡
        async function executeValidatorTask() {
            const citation = document.getElementById('citation-input').value;
            const format = document.getElementById('citation-format').value;

            if (!citation.trim()) {
                showError('validator-response', 'è¯·è¾“å…¥å¼•ç”¨ä¿¡æ¯');
                return;
            }

            showLoading('validator-loading');

            try {
                const response = await fetch('/api/v1/citations/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        citation: citation,
                        format: format
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess('validator-response', 'å¼•ç”¨æ ¡éªŒå®Œæˆ', data);
                } else {
                    showError('validator-response', data.detail || 'æ ¡éªŒå¤±è´¥');
                }
            } catch (error) {
                showError('validator-response', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('validator-loading');
            }
        }

        // æ‰§è¡Œå®Œæ•´å·¥ä½œæµ
        async function executeWorkflow() {
            const keywords = document.getElementById('workflow-keywords').value;
            const limit = document.getElementById('workflow-limit').value;
            const analysisType = document.getElementById('workflow-analysis-type').value;
            const citationFormat = document.getElementById('workflow-citation-format').value;
            const generateReport = document.getElementById('workflow-generate-report').checked;

            if (!keywords.trim()) {
                showError('workflow-response', 'è¯·è¾“å…¥ç ”ç©¶å…³é”®è¯');
                return;
            }

            showLoading('workflow-loading');

            try {
                const response = await fetch('/api/v1/workflow/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        keywords: keywords,
                        limit: parseInt(limit),
                        analysis_type: analysisType,
                        citation_format: citationFormat,
                        writing_task: generateReport ? 'improve' : null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess('workflow-response', 'å·¥ä½œæµæ‰§è¡Œå®Œæˆ', data);
                } else {
                    showError('workflow-response', data.detail || 'å·¥ä½œæµæ‰§è¡Œå¤±è´¥');
                }
            } catch (error) {
                showError('workflow-response', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('workflow-loading');
            }
        }

        // è®¾ç½®æ–‡ä»¶ä¸Šä¼ 
        function setupFileUpload() {
            const uploadArea = document.getElementById('paper-upload-area');
            const fileInput = document.getElementById('paper-file');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    handleFileUpload(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            showLoading('miner-loading');

            try {
                // ä½¿ç”¨æ–°çš„ PDF è§£æç«¯ç‚¹
                const response = await fetch('/api/v1/analysis/upload-pdf', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    // è‡ªåŠ¨å¡«å…… URL å­—æ®µ
                    document.getElementById('paper-url').value = data.file_path || '';

                    // æ˜¾ç¤ºè§£æç»“æœ
                    const uploadInfo = `
                        <div class="paper-card">
                            <h4>ğŸ“„ ${data.title || file.name}</h4>
                            <div class="authors">
                                ğŸ‘¥ ä½œè€…ï¼š${data.authors ? data.authors.join(', ') : 'æœªçŸ¥'}
                            </div>
                            <div class="abstract">
                                ğŸ“ ${data.abstract || 'æš‚æ— æ‘˜è¦'}
                            </div>
                            <div class="meta">
                                <span>ğŸ“„ ${data.page_count || 0} é¡µ</span>
                                <span>ï¿½ ${data.word_count || 0} è¯</span>
                                <span>âœ… è§£æå®Œæˆ</span>
                            </div>
                        </div>
                    `;

                    showSuccess('miner-response', 'PDF æ–‡ä»¶ä¸Šä¼ å¹¶è§£ææˆåŠŸï¼Œç°åœ¨å¯ä»¥é€‰æ‹©åˆ†æç±»å‹å¹¶å¼€å§‹åˆ†æã€‚', {
                        upload_info: uploadInfo
                    });
                } else {
                    showError('miner-response', data.detail || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                showError('miner-response', `ä¸Šä¼ é”™è¯¯: ${error.message}`);
            } finally {
                hideLoading('miner-loading');
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(loadingId) {
            document.getElementById(loadingId).classList.add('active');
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading(loadingId) {
            document.getElementById(loadingId).classList.remove('active');
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(responseId, message, data = null) {
            const responseDiv = document.getElementById(responseId);

            let content = `<div class="success">${message}</div>`;

            if (data) {
                // å·¥ä½œæµç»“æœ
                if (data.steps && Array.isArray(data.steps)) {
                    content += formatWorkflowResult(data);
                }
                // PDF ä¸Šä¼ ä¿¡æ¯
                else if (data.upload_info) {
                    content += data.upload_info;
                }
                // è®ºæ–‡æœç´¢ç»“æœ
                else if (data.papers && Array.isArray(data.papers)) {
                    content += formatPaperResults(data);
                }
                // è®ºæ–‡åˆ†æç»“æœ
                else if (data.analysis) {
                    content += formatAnalysisResult(data);
                }
                // å†™ä½œåŠ©æ‰‹ç»“æœ
                else if (data.result && typeof data.result === 'string') {
                    content += formatWritingResult(data);
                }
                // å¼•ç”¨æ ¡éªŒç»“æœ
                else if (data.formatted_citation) {
                    content += formatCitationResult(data);
                }
                // å…¶ä»–ç±»å‹çš„æ•°æ®ç”¨æ ¼å¼åŒ–çš„ JSON å±•ç¤º
                else {
                    const jsonStr = JSON.stringify(data, null, 2);
                    const jsonId = 'json-' + Date.now();
                    content += `
                        <div style="position: relative;">
                            <button class="copy-btn" onclick="copyToClipboard('${jsonId}', event)">ğŸ“‹ å¤åˆ¶</button>
                            <pre id="${jsonId}">${syntaxHighlight(jsonStr)}</pre>
                        </div>
                    `;
                }
            }

            responseDiv.innerHTML = content;
        }

        // æ ¼å¼åŒ–è®ºæ–‡æœç´¢ç»“æœ
        function formatPaperResults(data) {
            let html = `
                <div class="result-header">
                    <span>ï¿½ æ£€ç´¢ç»“æœ</span>
                    <span class="result-stats">å…± ${data.papers.length} ç¯‡</span>
                </div>
            `;

            data.papers.forEach((paper, index) => {
                html += `
                    <div class="paper-card">
                        <h4>${index + 1}. ${escapeHtml(paper.title)}</h4>
                        <div class="authors">
                            ğŸ‘¥ ä½œè€…ï¼š${paper.authors.join(', ')}
                        </div>
                        <div class="abstract">
                            ğŸ“ ${escapeHtml(paper.abstract)}
                        </div>
                        <div class="meta">
                            <span>ğŸ“… ${paper.published_date}</span>
                            <span>ğŸ”— <a href="${paper.url}" target="_blank">æŸ¥çœ‹åŸæ–‡</a></span>
                            ${paper.pdf_url ? `<span>ğŸ“„ <a href="${paper.pdf_url}" target="_blank">ä¸‹è½½PDF</a></span>` : ''}
                            <span>ğŸ†” ${paper.id}</span>
                        </div>
                    </div>
                `;
            });

            return html;
        }

        // æ ¼å¼åŒ–è®ºæ–‡åˆ†æç»“æœ
        function formatAnalysisResult(data) {
            let html = `
                <div class="result-header">
                    <span>ğŸ“Š åˆ†æç»“æœ</span>
                    <span class="result-stats">${data.analysis_type}</span>
                </div>
            `;

            if (data.paper_info) {
                html += `
                    <div class="paper-card">
                        <h4>${escapeHtml(data.paper_info.title)}</h4>
                        <div class="authors">
                            ğŸ‘¥ ä½œè€…ï¼š${data.paper_info.authors.join(', ')}
                        </div>
                        <div class="meta">
                            <span>ğŸ“… ${data.paper_info.published_date}</span>
                            <span>ğŸ”— <a href="${data.paper_info.url}" target="_blank">æŸ¥çœ‹åŸæ–‡</a></span>
                            <span>ğŸ·ï¸ ${data.paper_info.categories.join(', ')}</span>
                        </div>
                    </div>
                `;
            }

            const analysisId = 'analysis-' + Date.now();
            html += '<div class="paper-card">';
            html += '<h4>åˆ†æå†…å®¹ <button class="copy-btn" onclick="copyToClipboard(\'' + analysisId + '\', event)">å¤åˆ¶</button></h4>';
            html += '<div class="markdown-content" id="' + analysisId + '">';
            html += renderMarkdown(data.analysis);
            html += '</div>';
            html += '</div>';

            return html;
        }

        // æ”¹è¿›çš„ Markdown æ¸²æŸ“å™¨
        function renderMarkdown(text) {
            if (!text) return '';

            // æŒ‰è¡Œå¤„ç†
            const lines = text.split('\n');
            let html = '';
            let inList = false;
            let listItems = [];

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];

                // è·³è¿‡ç©ºè¡Œ
                if (!line.trim()) {
                    if (inList) {
                        html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                        listItems = [];
                        inList = false;
                    }
                    html += '<br/>';
                    continue;
                }

                // æ ‡é¢˜ (å¿…é¡»åœ¨è¡Œé¦–) - ä»æœ€é•¿çš„å¼€å§‹åŒ¹é…
                const h4Match = line.match(/^####\s+(.+)$/);
                if (h4Match) {
                    if (inList) {
                        html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                        listItems = [];
                        inList = false;
                    }
                    html += '<h4 style="color: #667eea; margin: 15px 0 8px 0; font-size: 1.05rem; font-weight: 600;">' + formatInlineMarkdown(h4Match[1]) + '</h4>';
                    continue;
                }

                const h3Match = line.match(/^###\s+(.+)$/);
                if (h3Match) {
                    if (inList) {
                        html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                        listItems = [];
                        inList = false;
                    }
                    html += '<h3 style="color: #667eea; margin: 20px 0 10px 0; font-size: 1.1rem; font-weight: 600;">' + formatInlineMarkdown(h3Match[1]) + '</h3>';
                    continue;
                }

                const h2Match = line.match(/^##\s+(.+)$/);
                if (h2Match) {
                    if (inList) {
                        html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                        listItems = [];
                        inList = false;
                    }
                    html += '<h2 style="color: #667eea; margin: 25px 0 15px 0; font-size: 1.3rem; font-weight: 600;">' + formatInlineMarkdown(h2Match[1]) + '</h2>';
                    continue;
                }

                const h1Match = line.match(/^#\s+(.+)$/);
                if (h1Match) {
                    if (inList) {
                        html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                        listItems = [];
                        inList = false;
                    }
                    html += '<h1 style="color: #667eea; margin: 30px 0 20px 0; font-size: 1.5rem; font-weight: 600;">' + formatInlineMarkdown(h1Match[1]) + '</h1>';
                    continue;
                }

                // æœ‰åºåˆ—è¡¨
                const orderedMatch = line.match(/^(\d+)\.\s+(.+)$/);
                if (orderedMatch) {
                    const content = orderedMatch[2];
                    const formatted = formatInlineMarkdown(content);
                    listItems.push(`<li style="margin: 10px 0; line-height: 1.8;">${formatted}</li>`);
                    inList = true;
                    continue;
                }

                // æ— åºåˆ—è¡¨
                const unorderedMatch = line.match(/^[-*]\s+(.+)$/);
                if (unorderedMatch) {
                    const content = unorderedMatch[1];
                    const formatted = formatInlineMarkdown(content);
                    listItems.push(`<li style="margin: 10px 0; line-height: 1.8;">${formatted}</li>`);
                    inList = true;
                    continue;
                }

                // æ™®é€šæ®µè½
                if (inList) {
                    html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
                    listItems = [];
                    inList = false;
                }

                const formatted = formatInlineMarkdown(line);
                html += `<p style="margin: 12px 0; line-height: 1.8; color: #444;">${formatted}</p>`;
            }

            // å¤„ç†æœªé—­åˆçš„åˆ—è¡¨
            if (inList) {
                html += '<ul style="list-style-type: disc; padding-left: 25px; margin: 15px 0;">' + listItems.join('') + '</ul>';
            }

            return html;
        }

        // æ ¼å¼åŒ–è¡Œå†… Markdown å…ƒç´ 
        function formatInlineMarkdown(text) {
            // è½¬ä¹‰ HTML
            text = escapeHtml(text);

            // ç²—ä½“ **text**
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong style="color: #333; font-weight: 600;">$1</strong>');

            // æ–œä½“ *text*
            text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // è¡Œå†…ä»£ç  `code`
            text = text.replace(/`([^`]+)`/g, '<code style="background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: monospace; color: #e83e8c; font-size: 0.9em;">$1</code>');

            // é“¾æ¥ [text](url)
            text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: #667eea; text-decoration: none; border-bottom: 1px solid #667eea;">$1</a>');

            return text;
        }

        // æ ¼å¼åŒ–å†™ä½œåŠ©æ‰‹ç»“æœ
        function formatWritingResult(data) {
            let html = `
                <div class="result-header">
                    <span>âœï¸ å†™ä½œç»“æœ</span>
                    <span class="result-stats">ä»»åŠ¡ï¼š${data.task}ï½œé£æ ¼ï¼š${data.style}</span>
                </div>
            `;

            if (data.original) {
                html += `
                    <div class="paper-card">
                        <h4>ğŸ“ åŸæ–‡</h4>
                        <div class="abstract" style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            ${escapeHtml(data.original)}
                        </div>
                    </div>
                `;
            }

            const resultId = 'writing-result-' + Date.now();
            html += '<div class="paper-card">';
            html += '<h4>å¤„ç†ç»“æœ <button class="copy-btn" onclick="copyToClipboard(\'' + resultId + '\', event)">å¤åˆ¶</button></h4>';
            html += '<div class="markdown-content" id="' + resultId + '">';
            html += renderMarkdown(data.result);
            html += '</div>';
            html += '</div>';

            return html;
        }

        // æ ¼å¼åŒ–å¼•ç”¨æ ¡éªŒç»“æœ
        function formatCitationResult(data) {

            const jsonId = 'citation-' + Date.now();
            let html = `
                <div class="result-header">
                    <span>ğŸ§¾ å¼•ç”¨æ ¡éªŒä¸æ ¼å¼åŒ–</span>
                    <span class="result-stats">${data.format.toUpperCase()}ï½œ${data.verified ? 'å·²éªŒè¯' : 'æœªéªŒè¯'}</span>
                </div>
            `;

            if (data.metadata) {
                const meta = data.metadata;

                // å¤„ç†æ ‡é¢˜
                let title = 'N/A';
                if (meta.title) {
                    title = Array.isArray(meta.title) ? meta.title[0] : meta.title;
                }

                // å¤„ç†ä½œè€…
                let authors = 'N/A';
                if (meta.authors) {
                    if (Array.isArray(meta.authors)) {
                        authors = meta.authors.join(', ');
                    } else {
                        authors = meta.authors;
                    }
                }

                // å¤„ç†å¹´ä»½
                let year = 'N/A';
                if (meta.year) {
                    year = meta.year;
                } else if (meta.published && meta.published['date-parts']) {
                    year = meta.published['date-parts'][0][0];
                }

                // å¤„ç†æœŸåˆŠ
                let journal = 'N/A';
                if (meta.journal) {
                    journal = meta.journal;
                } else if (meta['container-title']) {
                    journal = Array.isArray(meta['container-title']) ? meta['container-title'][0] : meta['container-title'];
                }

                html += `
                    <div class="paper-card">
                        <h4>ğŸ“„ è®ºæ–‡ä¿¡æ¯</h4>
                        <div class="authors">
                            ğŸ“– æ ‡é¢˜ï¼š${escapeHtml(title)}
                        </div>
                        <div class="authors">
                            ğŸ‘¥ ä½œè€…ï¼š${escapeHtml(authors)}
                        </div>
                        <div class="meta">
                            <span>ğŸ“… ${year}</span>
                            <span>ğŸ“š ${escapeHtml(journal)}</span>
                            ${meta.arxiv_id ? `<span>ğŸ”— arXiv:${meta.arxiv_id}</span>` : ''}
                            ${meta.doi ? `<span>ğŸ”— DOI:${meta.doi}</span>` : ''}
                        </div>
                    </div>
                `;
            }

            html += `
                <div class="paper-card">
                    <h4>ğŸ“‹ æ ¼å¼åŒ–å¼•ç”¨ <button class="copy-btn" onclick="copyToClipboard('${jsonId}', event)">å¤åˆ¶</button></h4>
                    <pre id="${jsonId}">${escapeHtml(data.formatted_citation)}</pre>
                </div>
            `;

            if (data.warnings && data.warnings.length > 0) {
                html += `
                    <div class="error">
                        âš ï¸ ${data.warnings.join('; ')}
                    </div>
                `;
            }

            return html;
        }

        // æ ¼å¼åŒ–å·¥ä½œæµç»“æœ
        function formatWorkflowResult(data) {
            let html = `
                <div class="result-header">
                    <span>ğŸ§© å·¥ä½œæµç»“æœ</span>
                    <span class="result-stats">${data.status === 'completed' ? 'å·²å®Œæˆ' : 'éƒ¨åˆ†å®Œæˆ'}</span>
                </div>
            `;

            // æ˜¾ç¤ºæ‘˜è¦
            if (data.summary) {
                html += `
                    <div class="paper-card">
                        <h4>ğŸ“Š æ‰§è¡Œæ‘˜è¦</h4>
                        <div class="meta">
                            <span>ğŸ“š æ‰¾åˆ° ${data.summary.total_papers} ç¯‡è®ºæ–‡</span>
                            <span>ğŸ§  åˆ†æ ${data.summary.analyzed_papers} ç¯‡</span>
                            <span>ğŸ“ ç”Ÿæˆ ${data.summary.generated_citations} æ¡å¼•ç”¨</span>
                        </div>
                        <p class="muted" style="margin-top: 10px;">å…³é”®è¯ï¼š${data.summary.keywords}</p>
                    </div>
                `;
            }

            // æ˜¾ç¤ºå„æ­¥éª¤ç»“æœ
            if (data.steps && data.steps.length > 0) {
                data.steps.forEach((step, index) => {
                    const statusIcon = step.status === 'completed' ? 'âœ…' : step.status === 'failed' ? 'âŒ' : 'â³';

                    html += `
                        <div class="paper-card">
                            <h4>${statusIcon} æ­¥éª¤ ${step.step}: ${step.name}</h4>
                    `;

                    if (step.status === 'completed' && step.result) {
                        // è®ºæ–‡æœç´¢ç»“æœ
                        if (step.result.papers) {
                            html += `<p>æ‰¾åˆ° ${step.result.total_found} ç¯‡è®ºæ–‡</p>`;
                            step.result.papers.slice(0, 3).forEach((paper, i) => {
                                html += `
                                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                        <strong>${i + 1}. ${escapeHtml(paper.title)}</strong><br>
                                        <small>ä½œè€…: ${paper.authors.slice(0, 3).join(', ')}${paper.authors.length > 3 ? ' et al.' : ''}</small>
                                    </div>
                                `;
                            });
                        }

                        // åˆ†æç»“æœ
                        if (step.result.analyses) {
                            html += `<p>å®Œæˆ ${step.result.total_analyzed} ç¯‡è®ºæ–‡åˆ†æ</p>`;
                            step.result.analyses.forEach((analysis, i) => {
                                html += `
                                    <div style="margin: 10px 0; padding: 10px; background: #f0f7ff; border-radius: 5px;">
                                        <strong>${i + 1}. ${escapeHtml(analysis.title)}</strong>
                                        <div class="markdown-content" style="margin-top: 10px;">
                                            ${renderMarkdown(analysis.analysis.substring(0, 500) + '...')}
                                        </div>
                                    </div>
                                `;
                            });
                        }

                        // å¼•ç”¨ç»“æœ
                        if (step.result.citations) {
                            html += `<p>ç”Ÿæˆ ${step.result.total_citations} æ¡å¼•ç”¨</p>`;
                            const citationId = 'citations-' + Date.now();
                            html += `<button class="copy-btn" onclick="copyToClipboard('${citationId}', event)">ğŸ“‹ å¤åˆ¶å…¨éƒ¨å¼•ç”¨</button>`;
                            html += `<div id="${citationId}" style="margin-top: 10px;">`;
                            step.result.citations.forEach((citation, i) => {
                                html += `<p style="margin: 5px 0;">${i + 1}. ${escapeHtml(citation.formatted_citation)}</p>`;
                            });
                            html += '</div>';
                        }

                        // æŠ¥å‘Šç»“æœ
                        if (step.result.report) {
                            const reportId = 'report-' + Date.now();
                            html += `<button class="copy-btn" onclick="copyToClipboard('${reportId}', event)">ğŸ“‹ å¤åˆ¶æŠ¥å‘Š</button>`;
                            html += `<div class="markdown-content" id="${reportId}" style="margin-top: 10px;">`;
                            html += renderMarkdown(step.result.report);
                            html += '</div>';
                        }
                    } else if (step.status === 'failed') {
                        html += `<p style="color: #f44336;">é”™è¯¯: ${step.error}</p>`;
                    }

                    html += '</div>';
                });
            }

            return html;
        }

        // HTML è½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // JSON è¯­æ³•é«˜äº®
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(elementId, event) {
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }

            const element = document.getElementById(elementId);
            if (!element) {
                return;
            }

            // è·å–çº¯æ–‡æœ¬å†…å®¹
            const text = element.innerText || element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                const btn = event ? event.target : null;
                if (btn) {
                    const originalText = btn.textContent;
                    btn.textContent = 'âœ… å·²å¤åˆ¶';
                    btn.textContent = 'å·²å¤åˆ¶';
                    btn.style.background = '#16a34a';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#16a34a';

                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                        btn.style.color = '';
                        btn.style.borderColor = '';
                    }, 2000);
                }
                console.log('å·²å¤åˆ¶ ' + text.length + ' ä¸ªå­—ç¬¦');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
            });
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(responseId, message) {
            const responseDiv = document.getElementById(responseId);
            responseDiv.innerHTML = `
                <div class="error">
                    ${message}
                </div>
            `;
        }
    </script>
</body>

</html>
